
# Data Analyze Helper (æ•°æ®åˆ†æåŠ©æ‰‹)

åŸºäº Mastra æ¡†æ¶æ„å»ºçš„æ™ºèƒ½å¤šæ™ºèƒ½ä½“åŠ©æ‰‹ï¼Œé›†æˆ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ã€æ•°æ®åˆ†æã€çƒ­ç‚¹æ–°é—»ã€ä½“è‚²èµ„è®¯ç­‰åŠŸèƒ½ã€‚

[English Documentation](./README.md)

## ğŸŒŸ åŠŸèƒ½ç‰¹æ€§

### å¤šæ™ºèƒ½ä½“åä½œæ¶æ„
- **Secretary Agentï¼ˆç§˜ä¹¦æ™ºèƒ½ä½“ï¼‰** - ä¸»åè°ƒè€…ï¼Œè´Ÿè´£ä»»åŠ¡è·¯ç”±å’Œç®¡ç†
- **Data Analyze Agentï¼ˆæ•°æ®åˆ†ææ™ºèƒ½ä½“ï¼‰** - MySQL æ•°æ®åº“æŸ¥è¯¢å’Œåˆ†æä¸“å®¶
- **Hot News Agentï¼ˆçƒ­ç‚¹æ–°é—»æ™ºèƒ½ä½“ï¼‰** - ä¸­æ–‡å¹³å°çƒ­ç‚¹è¯é¢˜ï¼ˆçŸ¥ä¹ã€å¾®åšã€Bç«™ç­‰ï¼‰
- **Employee Rules Agentï¼ˆå‘˜å·¥æ‰‹å†Œæ™ºèƒ½ä½“ï¼‰** - åŸºäº RAG çš„ HR æ”¿ç­–å’Œæ‰‹å†ŒåŠ©æ‰‹

### é›†æˆçš„ MCP æœåŠ¡
- **Hot News MCP** - é€šè¿‡ Exa API è·å–çƒ­ç‚¹æ–°é—»
- **12306 MCP** - ä¸­å›½é“è·¯ç«è½¦ç¥¨æŸ¥è¯¢
- **DBHub MCP** - MySQL æ•°æ®åº“è¿æ¥
- **BallDontLie MCP** - å¤šè”èµ›ä½“è‚²æ•°æ®ï¼ˆNBA/NFL/MLB/NHL/CBAï¼‰

### æ ¸å¿ƒèƒ½åŠ›
- ğŸ“Š æ•°æ®åº“æŸ¥è¯¢å’Œ SQL åˆ†æ
- ğŸ“° ä¸­æ–‡å¹³å°å®æ—¶çƒ­ç‚¹æ–°é—»
- âš½ å¤šè”èµ›ä½“è‚²ç»Ÿè®¡æ•°æ®
- ğŸš„ ç«è½¦ç¥¨æœç´¢å’Œè¡Œç¨‹è§„åˆ’
- ğŸ“– **åŸºäº RAG çš„å‘˜å·¥æ‰‹å†Œæ™ºèƒ½é—®ç­”ï¼ˆChromaDBï¼‰**
- ğŸ¤– æ™ºèƒ½ä½“é—´åä½œï¼ˆA2Aï¼‰
- ğŸ’¾ åŸºäº LibSQL çš„å¯¹è¯è®°å¿†

## ğŸ“‹ å‰ç½®è¦æ±‚

- **Node.js** >= 20.9.0
- **MySQL**ï¼ˆå¯é€‰ï¼Œç”¨äºæ•°æ®åˆ†æåŠŸèƒ½ï¼‰
- **ChromaDB**ï¼ˆç”¨äº RAG åŠŸèƒ½ï¼Œå¯é€šè¿‡ Docker è¿è¡Œï¼‰
- å„ç§æœåŠ¡çš„ API Keysï¼ˆè§é…ç½®éƒ¨åˆ†ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. ç¯å¢ƒé…ç½®

å¤åˆ¶ `env.example` ä¸º `.env`ï¼š

```bash
cp env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„é…ç½®ï¼š

```env
# OpenAI API é…ç½®
OPENAI_API_KEY=sk-your-actual-api-key
OPENAI_BASE_URL=https://api.openai.com/v1

# Chroma å‘é‡æ•°æ®åº“ï¼ˆç”¨äº RAGï¼‰
CHROMA_HOST=localhost
CHROMA_PORT=8000
CHROMA_COLLECTION=employee_rules

# EXA APIï¼ˆçƒ­ç‚¹æ–°é—»ï¼‰- ä» https://exa.ai è·å–
EXA_API_KEY=your-exa-api-key

# BallDontLie APIï¼ˆä½“è‚²ï¼‰- ä» https://balldontlie.com è·å–
BALLDONTLIE_API_KEY=your-balldontlie-api-key

# MySQL æ•°æ®åº“è¿æ¥ï¼ˆå¯é€‰ï¼‰
MYSQL_DSN=mysql://username:password@host:port/database?sslmode=disable
```

### 3. é…ç½® ChromaDBï¼ˆRAG åŠŸèƒ½å¿…éœ€ï¼‰

#### æ–¹å¼ Aï¼šDockerï¼ˆæ¨èï¼‰

```bash
docker run -d -p 8000:8000 \
  -v ./chroma-data:/chroma/chroma \
  --name chromadb \
  chromadb/chroma:latest
```

#### æ–¹å¼ Bï¼šPython å®‰è£…

```bash
pip install chromadb
chroma run --host localhost --port 8000 --path ./chroma-data
```

### 4. ç´¢å¼•å‘˜å·¥æ‰‹å†Œï¼ˆé¦–æ¬¡é…ç½®ï¼‰

å°†ä½ çš„å‘˜å·¥æ‰‹å†Œæ–‡æ¡£æ”¾åœ¨ `data/employee-rules.txt` æˆ– `data/employee-rules.pdf`ï¼Œç„¶åè¿è¡Œï¼š

```bash
npm run index-pdf
```

é¢„æœŸè¾“å‡ºï¼š
```
ğŸš€ å¼€å§‹ç´¢å¼•å‘˜å·¥è§„åˆ™æ–‡æ¡£...
ğŸ“„ è¯»å–æ–‡æ¡£: data/employee-rules.txt
ğŸ“š æå–äº† 10000+ å­—ç¬¦
âœ‚ï¸  åˆ†å‰²æˆ 28 ä¸ªå—
ğŸ§® ç”ŸæˆåµŒå…¥å‘é‡...
âœ… ç”Ÿæˆäº† 28 ä¸ªåµŒå…¥å‘é‡
ğŸ“¦ ç´¢å¼•åˆ° Chroma: employee_rules
âœ… ç´¢å¼•å®Œæˆï¼
```

### 5. è¿è¡Œé¡¹ç›®

#### å¼€å‘æ¨¡å¼
```bash
npm run dev
```

æœåŠ¡å°†åœ¨ `http://localhost:4111` å¯åŠ¨

#### ç”Ÿäº§æ„å»º
```bash
npm run build
npm start
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
DataAnalyzeHelper/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ mastra/
â”‚       â”œâ”€â”€ agents/              # æ™ºèƒ½ä½“å®šä¹‰
â”‚       â”‚   â”œâ”€â”€ secretary-agent.ts
â”‚       â”‚   â”œâ”€â”€ data-analyze-agent.ts
â”‚       â”‚   â”œâ”€â”€ hot-news-agent.ts
â”‚       â”‚   â””â”€â”€ employee-ruler-agent.ts  # RAG æ™ºèƒ½ä½“
â”‚       â”œâ”€â”€ mcp/                 # MCP å®¢æˆ·ç«¯
â”‚       â”‚   â”œâ”€â”€ hot-news-client.ts
â”‚       â”‚   â”œâ”€â”€ 12306-client.ts
â”‚       â”‚   â”œâ”€â”€ mysql-client.ts
â”‚       â”‚   â””â”€â”€ sport-news-client.ts
â”‚       â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚       â”œâ”€â”€ tools/               # è‡ªå®šä¹‰å·¥å…·
â”‚       â”œâ”€â”€ workflows/           # å·¥ä½œæµ
â”‚       â””â”€â”€ index.ts             # Mastra å®ä¾‹
â”œâ”€â”€ data/                        # RAG æ–‡æ¡£
â”‚   â””â”€â”€ employee-rules.txt
â”œâ”€â”€ scripts/                     # å·¥å…·è„šæœ¬
â”‚   â””â”€â”€ index-pdf.ts             # æ–‡æ¡£ç´¢å¼•è„šæœ¬
â”œâ”€â”€ chroma-data/                 # ChromaDB å­˜å‚¨ï¼ˆå·²å¿½ç•¥ï¼‰
â”œâ”€â”€ env.example                  # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸ¤– æ™ºèƒ½ä½“æ¦‚è§ˆ

### Secretary Agentï¼ˆç§˜ä¹¦æ™ºèƒ½ä½“ï¼‰
ä¸»åè°ƒè€…ï¼Œè´Ÿè´£ï¼š
- æ¥æ”¶å’Œè·¯ç”±ç”¨æˆ·è¯·æ±‚
- ç›´æ¥å¤„ç†ï¼šç«è½¦ç¥¨ã€ä½“è‚²æ–°é—»
- å§”æ´¾ä»»åŠ¡ï¼šæ•°æ®åˆ†æã€çƒ­ç‚¹æ–°é—»ã€HR æ”¿ç­–

### Data Analyze Agentï¼ˆæ•°æ®åˆ†ææ™ºèƒ½ä½“ï¼‰
ä¸“ä¸šæ•°æ®åˆ†æå¸ˆï¼Œèƒ½å¤Ÿï¼š
- æŸ¥è¯¢ MySQL æ•°æ®åº“ç»“æ„
- æ‰§è¡Œ SQL æŸ¥è¯¢
- åˆ†ææ•°æ®å¹¶ç”Ÿæˆæ´å¯Ÿ
- åˆ›å»ºç»“æ„åŒ–æ•°æ®æŠ¥å‘Š

### Hot News Agentï¼ˆçƒ­ç‚¹æ–°é—»æ™ºèƒ½ä½“ï¼‰
è·å–çƒ­ç‚¹è¯é¢˜ï¼š
- çŸ¥ä¹çƒ­æ¦œ
- å¾®åšçƒ­æœ
- Bç«™çƒ­é—¨
- æŠ–éŸ³ã€è™æ‰‘ã€è±†ç“£ç­‰

### Employee Rules Agentï¼ˆå‘˜å·¥æ‰‹å†Œæ™ºèƒ½ä½“ - RAGï¼‰
AI é©±åŠ¨çš„ HR åŠ©æ‰‹åŠŸèƒ½ï¼š
- **å‘é‡æœç´¢**ï¼šä½¿ç”¨ ChromaDB è¿›è¡Œè¯­ä¹‰ç›¸ä¼¼åº¦æœç´¢
- **æ··åˆæ£€ç´¢**ï¼šç»“åˆå‘é‡æœç´¢ + å…³é”®è¯åŒ¹é…
- **å¤šå¬å›æº**ï¼šä½¿ç”¨ RRFï¼ˆå€’æ•°æ’åèåˆï¼‰æé«˜å‡†ç¡®ç‡
- **åŒè¯­æ”¯æŒ**ï¼šä¸­æ–‡å’Œè‹±æ–‡æŸ¥è¯¢
- **æ¥æºå¼•ç”¨**ï¼šå§‹ç»ˆå¼•ç”¨æ‰‹å†ŒåŸæ–‡

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### å‘˜å·¥æ‰‹å†ŒæŸ¥è¯¢ï¼ˆRAGï¼‰
```
ç”¨æˆ·ï¼šå…¬å¸æœ‰å“ªäº›å‡æœŸç±»å‹ï¼Ÿ
â†’ Secretary Agent â†’ Employee Rules Agent â†’ RAG æœç´¢ â†’ è¿”å› 7 ç§å‡æœŸç±»å‹åŠå¼•ç”¨
```

### ä½“è‚²æ–°é—»
```
ç”¨æˆ·ï¼šä»Šå¤© NBA æ¯”èµ›ç»“æœ
â†’ Secretary Agent â†’ ä½“è‚²æ–°é—»å·¥å…· â†’ è¿”å›ä»Šæ—¥ NBA æ¯”èµ›
```

### çƒ­ç‚¹è¯é¢˜
```
ç”¨æˆ·ï¼šå¾®åšçƒ­æœæœ‰ä»€ä¹ˆï¼Ÿ
â†’ Secretary Agent â†’ Hot News Agent â†’ è¿”å›å¾®åšçƒ­æœæ¦œ
```

### æ•°æ®åº“åˆ†æ
```
ç”¨æˆ·ï¼šæŸ¥è¯¢ tb_shop è¡¨çš„é”€å”®æ•°æ®
â†’ Secretary Agent â†’ Data Analyze Agent â†’ æ‰§è¡Œ SQL â†’ åˆ†ææŠ¥å‘Š
```

### ç«è½¦ç¥¨æŸ¥è¯¢
```
ç”¨æˆ·ï¼šåŒ—äº¬åˆ°ä¸Šæµ·çš„é«˜é“
â†’ Secretary Agent â†’ 12306 å·¥å…· â†’ è¿”å›å¯ç”¨è½¦æ¬¡
```

## ğŸ”¬ RAG ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·æé—®
    â†“
Employee Rules Agent
    â†“
å¤šå¬å›æºæ£€ç´¢ï¼ˆæ··åˆæœç´¢ï¼‰
    â”œâ”€â†’ å‘é‡æœç´¢ï¼ˆè¯­ä¹‰ç†è§£ï¼‰
    â”œâ”€â†’ å…³é”®è¯æœç´¢ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
    â””â”€â†’ RRF èåˆ
         â†“
ChromaDBï¼ˆå‘é‡æ•°æ®åº“ï¼‰
    â†“
Top-K ç›¸å…³æ–‡æ¡£å—
    â†“
GPT-4o-miniï¼ˆç­”æ¡ˆç”Ÿæˆï¼‰
    â†“
ç»“æ„åŒ–ç­”æ¡ˆ + åŸæ–‡å¼•ç”¨
```

### RAG ä¼˜åŒ–ç‰¹æ€§

1. **æ··åˆæ£€ç´¢**
   - å‘é‡æœç´¢ï¼šè¯­ä¹‰ç†è§£
   - å…³é”®è¯æå–ï¼šç²¾ç¡®åŒ¹é…
   - RRF èåˆï¼šæœ€ä¼˜ç»“æœ

2. **æ™ºèƒ½åˆ†å—**
   - å—å¤§å°ï¼š512 å­—ç¬¦
   - é‡å ï¼š50 å­—ç¬¦
   - ä¿æŒä¸Šä¸‹æ–‡è¿ç»­æ€§

3. **åµŒå…¥æ¨¡å‹**
   - æ¨¡å‹ï¼š`text-embedding-3-small`
   - ç»´åº¦ï¼š1536
   - æä¾›å•†ï¼šOpenAI

4. **å“åº”è´¨é‡**
   - ç›´æ¥å¼•ç”¨åŸæ–‡
   - è¯­è¨€åŒ¹é…ï¼ˆä¸­æ–‡ â†” è‹±æ–‡ï¼‰
   - æ¸…æ™°çš„"æœªæ‰¾åˆ°"å¤„ç†

## ğŸ”§ MCP æœåŠ¡é…ç½®

æ‰€æœ‰ MCP é…ç½®ä½äº `src/mastra/config/config.ts`ï¼Œä½¿ç”¨ç¯å¢ƒå˜é‡ã€‚

æ”¯æŒçš„æœåŠ¡ï¼š
- `mcp-server-hotnews` - æ–°é—»æœåŠ¡ï¼ˆExaï¼‰
- `12306-mcp` - ç«è½¦ç¥¨æŸ¥è¯¢
- `dbhub` - MySQL æ•°æ®åº“
- `balldontlie` - ä½“è‚²æ•°æ®

## ğŸ“Š æ•°æ®æŒä¹…åŒ–

### LibSQLï¼ˆå¯¹è¯è®°å¿†ï¼‰
- ä½ç½®ï¼š`mastra.db`ï¼ˆå·²åœ¨ git ä¸­å¿½ç•¥ï¼‰
- å­˜å‚¨ï¼šæ™ºèƒ½ä½“å¯¹è¯ã€ä¸Šä¸‹æ–‡ã€å¯è§‚æµ‹æ€§æ•°æ®

### ChromaDBï¼ˆå‘é‡å­˜å‚¨ï¼‰
- ä½ç½®ï¼š`chroma-data/`ï¼ˆå·²åœ¨ git ä¸­å¿½ç•¥ï¼‰
- å­˜å‚¨ï¼šæ–‡æ¡£åµŒå…¥å‘é‡ã€å…ƒæ•°æ®
- æŒä¹…åŒ–ï¼šé€šè¿‡ Docker volume æˆ–æœ¬åœ°ç›®å½•

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

âœ… **åº”è¯¥åš**ï¼š
- æ‰€æœ‰æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡
- ä¿æŒ `.env` æ–‡ä»¶ä¸è¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- ä½¿ç”¨ `env.example` ä½œä¸ºæ¨¡æ¿
- å®šæœŸè½®æ¢ API å¯†é’¥

âŒ **ä¸åº”è¯¥åš**ï¼š
- å°† `.env` æäº¤åˆ° Git
- åœ¨æºä»£ç ä¸­ç¡¬ç¼–ç  API å¯†é’¥
- åœ¨å…¬å…±ä»“åº“åˆ†äº«å‡­è¯
- åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨ç”Ÿäº§å¯†é’¥

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°æ–‡æ¡£åˆ° RAG

1. å°†æ–‡æ¡£æ”¾åœ¨ `data/` ç›®å½•ï¼ˆ`.txt` æˆ– `.pdf`ï¼‰
2. å¦‚éœ€è¦ï¼Œæ›´æ–° `employee-ruler-agent.ts` ä¸­çš„æ–‡ä»¶è·¯å¾„
3. è¿è¡Œç´¢å¼•ï¼š`npm run index-pdf`
4. é‡å¯æœåŠ¡ï¼š`npm run dev`

### è‡ªå®šä¹‰ RAG å‚æ•°

åœ¨ `src/mastra/agents/employee-ruler-agent.ts` ä¸­ï¼š

```typescript
// å—å¤§å°å’Œé‡å 
maxSize: 512,     // å¢åŠ ä»¥è·å¾—æ›´å¤šä¸Šä¸‹æ–‡
overlap: 50,      // å¢åŠ ä»¥æé«˜è¿ç»­æ€§

// Top-K ç»“æœæ•°
topK: 5,          // æ£€ç´¢çš„æ–‡æ¡£å—æ•°é‡
```

### æ™ºèƒ½ä½“é—´é€šä¿¡

Mastra çš„ A2A æœºåˆ¶å®ç°æ— ç¼å§”æ´¾ï¼š

```typescript
agents: {
  secretaryAgent,
  dataAnalyzeAgent,
  hotNewsAgent,
  employeeRulerAgent,  // è‡ªåŠ¨æ³¨å†Œç”¨äº A2A
}
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**ï¼š[Mastra](https://mastra.ai) - AI æ™ºèƒ½ä½“æ¡†æ¶
- **AI æ¨¡å‹**ï¼šOpenAI GPT-4o-mini
- **å‘é‡æ•°æ®åº“**ï¼šChromaDB
- **åµŒå…¥æ¨¡å‹**ï¼šOpenAI text-embedding-3-small
- **æ•°æ®åº“**ï¼šLibSQLï¼ˆæœ¬åœ°ï¼‰ã€MySQLï¼ˆåˆ†æï¼‰
- **åè®®**ï¼šMCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰
- **è¯­è¨€**ï¼šTypeScript
- **è¿è¡Œæ—¶**ï¼šNode.js >= 20.9.0

## ğŸ› æ•…éšœæ’æŸ¥

### ChromaDB è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ ChromaDB æ˜¯å¦è¿è¡Œ
curl http://localhost:8000/api/v1/heartbeat

# é‡å¯ ChromaDB
docker restart chromadb
```

### ç´¢å¼•å¤±è´¥
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la data/employee-rules.txt

# æ£€æŸ¥ OpenAI API Key
echo $OPENAI_API_KEY
```

### RAG è¿”å›ç©ºç»“æœ
```bash
# éªŒè¯é›†åˆæ˜¯å¦å­˜åœ¨
curl http://localhost:8000/api/v1/collections

# é‡æ–°ç´¢å¼•æ–‡æ¡£
npm run index-pdf
```

## ğŸ“„ è®¸å¯è¯

ISC

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issues å’Œ Pull Requestsï¼

è¯·ç¡®ä¿ï¼š
- æäº¤ä¸­ä¸åŒ…å«æ•æ„Ÿæ•°æ®
- åŒæ—¶æ›´æ–° README.md å’Œ README.zh-CN.md
- æ›´æ”¹åæµ‹è¯• RAG åŠŸèƒ½

---

**ä½¿ç”¨ [Mastra](https://mastra.ai) ç”¨ â¤ï¸ æ„å»º**
